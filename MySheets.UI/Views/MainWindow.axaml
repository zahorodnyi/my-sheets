<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="using:MySheets.UI.ViewModels"
        xmlns:v="using:MySheets.UI.Views"
        xmlns:sheetEditor="clr-namespace:MySheets.UI.ViewModels.SheetEditor"
        mc:Ignorable="d" d:DesignWidth="1000" d:DesignHeight="600"
        x:Class="MySheets.UI.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        x:Name="RootWindow"
        Title="MySheets.UI">

    <Design.DataContext>
        <vm:MainWindowViewModel/>
    </Design.DataContext>

    <Window.Styles>
        <Style Selector="ToolTip">
            <Setter Property="Foreground" Value="#333333"/>
            <Setter Property="FontWeight" Value="Normal"/>
            <Setter Property="FontSize" Value="12"/>
        </Style>

        <Style Selector="Button.round">
            <Setter Property="Width" Value="18"/> <Setter Property="Height" Value="18"/>
            <Setter Property="CornerRadius" Value="9"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#C0C0C0"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Foreground" Value="#333333"/>
            <Setter Property="FontSize" Value="10"/>
            <Setter Property="Margin" Value="1"/> 
        </Style>
        <Style Selector="Button.round:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="#E0E0E0"/>
        </Style>
        
        <Style Selector="Button.menu">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Foreground" Value="#333333"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
        </Style>
        <Style Selector="Button.menu:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="#E0E0E0"/>
        </Style>

        <Style Selector="Button.tool">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="6,4"/>
            <Setter Property="CornerRadius" Value="2"/>
            <Setter Property="Foreground" Value="#444444"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>
        <Style Selector="Button.tool:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="#E8EAED"/>
        </Style>
        
        <Style Selector="Button.tool.toggled">
            <Setter Property="Background" Value="#D2E3FC"/>
            <Setter Property="Foreground" Value="#1A73E8"/>
        </Style>
        <Style Selector="Button.tool.toggled:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="#C2D7F9"/>
        </Style>

        <Style Selector="Button.close">
            <Setter Property="Width" Value="20"/>
            <Setter Property="Height" Value="20"/>
            <Setter Property="CornerRadius" Value="10"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Foreground" Value="#999999"/>
            <Setter Property="Padding" Value="0,0,0,1"/>
            <Setter Property="Margin" Value="5,0,0,0"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="FontSize" Value="12"/>
        </Style>
        <Style Selector="Button.close:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="#FFCDD2"/>
            <Setter Property="Foreground" Value="#D32F2F"/>
        </Style>

        <Style Selector="ListBoxItem">
            <Setter Property="Padding" Value="10,5,5,5"/>
            <Setter Property="Margin" Value="0,0,2,0"/>
            <Setter Property="Background" Value="#F0F0F0"/>
            <Setter Property="BorderBrush" Value="#C0C0C0"/>
            <Setter Property="BorderThickness" Value="0,0,1,0"/>
            <Setter Property="Foreground" Value="#333333"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>
        <Style Selector="ListBoxItem:selected /template/ ContentPresenter">
            <Setter Property="Background" Value="White"/>
            <Setter Property="TextBlock.Foreground" Value="#1A73E8"/>
            <Setter Property="TextBlock.FontWeight" Value="Bold"/>
        </Style>
        
        <Style Selector="Border.separator">
            <Setter Property="Width" Value="1"/>
            <Setter Property="Height" Value="20"/>
            <Setter Property="Background" Value="#E0E0E0"/>
            <Setter Property="Margin" Value="6,0"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>
    </Window.Styles>

    <DockPanel LastChildFill="True">
        <StackPanel DockPanel.Dock="Top">
            <Border Background="#F9FBFD" Padding="0,2">
                <StackPanel Orientation="Horizontal" Spacing="5">
                     <Button Classes="menu" Content="File">
                        <Button.Flyout>
                            <MenuFlyout>
                                <MenuItem Header="New" Command="{Binding AddNewSheetCommand}"/>
                                <Separator/>
                                <MenuItem Header="Open..." Click="OnOpenFileClick"/>
                                <MenuItem Header="Save As..." Click="OnSaveFileClick"/>
                            </MenuFlyout>
                        </Button.Flyout>
                    </Button>
                    <TextBlock Text="MySheets" Foreground="#1A73E8" FontWeight="SemiBold" VerticalAlignment="Center" Margin="5,0"/>
                </StackPanel>
            </Border>

            <Border Background="#F3F6FC" Padding="15,6" BorderBrush="#E0E0E0" BorderThickness="0,1,0,0">
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Spacing="20">
                    
                    <StackPanel Orientation="Horizontal" Spacing="5">
                        <Button Classes="tool" ToolTip.Tip="Undo">
                            <PathIcon Data="M12.5,8c-2.65,0-5.05,0.99-6.9,2.6L2,7v9h9l-3.62-3.62c1.39-1.16,3.16-1.88,5.12-1.88c3.54,0,6.55,2.31,7.6,5.5l2.37-0.78C21.08,11.03,17.15,8,12.5,8z" 
                                      Width="14" Height="14" Foreground="#444444"/>
                        </Button>
                        <Button Classes="tool" ToolTip.Tip="Redo">
                            <PathIcon Data="M18.4,10.6C16.55,9,14.15,8,11.5,8c-4.65,0-8.58,3.03-9.96,7.22L3.9,16c1.05-3.19,4.05-5.5,7.6-5.5c1.95,0,3.73,0.72,5.12,1.88L13,16h9V7L18.4,10.6z" 
                                      Width="14" Height="14" Foreground="#444444"/>
                        </Button>
                    </StackPanel>

                    <Border Classes="separator"/>

                    <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                        <StackPanel Orientation="Horizontal" Spacing="0">
                            <Button Classes="tool" 
                                    Command="{Binding DecreaseFontSizeCommand}"
                                    Width="24" Height="24" Padding="0" VerticalContentAlignment="Center" HorizontalContentAlignment="Center">
                                <TextBlock Text="-" FontWeight="Bold" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                            </Button>
                            
                            <Border BorderThickness="1" BorderBrush="#C0C0C0" CornerRadius="2" Background="White" Height="24" Width="40" Margin="2,0">
                                <TextBlock Text="{Binding ActiveSheet.SelectedCell.FontSize, FallbackValue=12}" 
                                           VerticalAlignment="Center" HorizontalAlignment="Center" FontSize="12"/>
                            </Border>
                            
                            <Button Classes="tool" 
                                    Command="{Binding IncreaseFontSizeCommand}"
                                    Width="24" Height="24" Padding="0" VerticalContentAlignment="Center" HorizontalContentAlignment="Center">
                                <TextBlock Text="+" FontWeight="Bold" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                            </Button>
                        </StackPanel>
                        
                        <Button Classes="tool" 
                                Classes.toggled="{Binding ActiveSheet.SelectedCell.IsBold}"
                                Width="28" Height="28" Padding="0"
                                HorizontalContentAlignment="Center" VerticalContentAlignment="Center"
                                ToolTip.Tip="Bold" 
                                Command="{Binding ToggleBoldCommand}">
                            <TextBlock Text="B" FontWeight="Bold" FontSize="15" Foreground="#444444"/>
                        </Button>
                        
                        <Button Classes="tool" 
                                Classes.toggled="{Binding ActiveSheet.SelectedCell.IsItalic}"
                                Width="28" Height="28" Padding="0"
                                HorizontalContentAlignment="Center" VerticalContentAlignment="Center"
                                ToolTip.Tip="Italic" 
                                Command="{Binding ToggleItalicCommand}">
                            <PathIcon Data="M6,19V16H9L12.63,7H10V4H17V7H14.37L10.75,16H13V19H6Z"
                                      Width="14" Height="14" Foreground="#444444"/>
                        </Button>
                    </StackPanel>

                    <Border Classes="separator"/>

                    <StackPanel Orientation="Horizontal" Spacing="5">
                        <Button Classes="tool" 
                                Width="28" Height="28" Padding="0"
                                HorizontalContentAlignment="Center" VerticalContentAlignment="Center"
                                ToolTip.Tip="Text Color" Command="{Binding SetTextColorCommand}">
                            <Panel>
                                <TextBlock Text="A" FontWeight="Normal" Foreground="Black" FontSize="15" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,0,0,2"/>
                                <Border Height="3" Width="14" Background="Red" VerticalAlignment="Bottom" Margin="0,0,0,4"/>
                            </Panel>
                        </Button>
                        
                        <Button Classes="tool" 
                                Width="28" Height="28" Padding="0"
                                HorizontalContentAlignment="Center" VerticalContentAlignment="Center"
                                ToolTip.Tip="Fill Color" Command="{Binding SetFillColorCommand}">
                            <PathIcon Data="M 59 67 L 41 99 L 39 129 L 48 157 L 66 179 L 25 229 L 22 284 L 37 313 L 158 434 L 199 452 L 252 442 L 397 301 L 432 310 L 454 330 L 469 366 L 475 435 L 482 448 L 492 445 L 507 384 L 505 295 L 480 235 L 430 179 L 381 145 L 325 120 L 225 20 L 125 30 L 86 46 Z M 170 61 L 184 61 L 113 133 L 156 146 L 226 77 L 395 246 L 236 405 L 216 413 L 181 401 L 70 290 L 59 269 L 65 238 L 101 201 L 160 218 L 238 225 L 259 239 L 278 237 L 293 225 L 297 196 L 277 175 L 257 174 L 239 186 L 166 179 L 118 165 L 85 141 L 79 110 L 96 87 Z"
                                      Width="16" Height="16" Foreground="#444444"/>
                        </Button>

                        <Button Classes="tool" 
                                Width="28" Height="28" Padding="0"
                                HorizontalContentAlignment="Center" VerticalContentAlignment="Center"
                                ToolTip.Tip="Borders" Command="{Binding ToggleBordersCommand}">
                            <PathIcon Data="M3,3V21H21V3H3M5,5H11V11H5V5M5,13H11V19H5V13M13,5H19V11H13V5M13,13H19V19H13V13Z" 
                                      Width="16" Height="16" Foreground="#444444"/>
                        </Button>
                    </StackPanel>

                    <Border Classes="separator"/>

                    <Button Classes="tool" ToolTip.Tip="Align Left" 
                            Width="28" Height="28" Padding="0"
                            HorizontalContentAlignment="Center" VerticalContentAlignment="Center">
                        <StackPanel Orientation="Horizontal" Spacing="3" VerticalAlignment="Center" HorizontalAlignment="Center">
                            <PathIcon Data="M3,21h18v-2H3V21z M3,17h12v-2H3V17z M3,13h18v-2H3V13z M3,9h12V7H3V9z M3,3v2h18V3H3z" 
                                      Width="12" Height="12" Foreground="#444444"/>
                            <PathIcon Data="M0,0 L4,4 L8,0" Width="6" Height="4" VerticalAlignment="Center" Foreground="#444444" Margin="0,0,0,0"/>
                        </StackPanel>
                    </Button>

                    <Border Classes="separator"/>

                    <Button Classes="tool" ToolTip.Tip="Functions"
                            Width="28" Height="28" Padding="0"
                            HorizontalContentAlignment="Center" VerticalContentAlignment="Center">
                         <TextBlock Text="∑" FontWeight="Normal" FontSize="18" Foreground="#444444"/>
                    </Button>

                </StackPanel>
            </Border>

            <Border Height="36" Background="White" BorderBrush="#E0E0E0" BorderThickness="0,1,0,1" Padding="6">
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBox Text="{Binding ActiveSheet.CurrentAddress}"
                             Width="75"
                             Height="24"
                             HorizontalContentAlignment="Center"
                             VerticalContentAlignment="Center"
                             BorderThickness="0"
                             IsReadOnly="True"
                             Focusable="False"
                             Background="Transparent"
                             FontWeight="Bold"
                             Foreground="#666666"/>

                    <Border Width="1" Height="16" Background="#E0E0E0" Margin="10,0"/>
                    
                    <TextBlock Text="fx" FontFamily="Times New Roman" FontStyle="Italic" FontWeight="Bold" VerticalAlignment="Center" Foreground="#999999" FontSize="16" Margin="0,0,10,0"/>
                    
                    <TextBox x:Name="FormulaBar"
                             Text="{Binding ActiveSheet.SelectedCell.Expression, Mode=TwoWay}" 
                             Width="300"
                             Height="24"
                             BorderThickness="0"
                             Background="Transparent"
                             CornerRadius="0"
                             Watermark="Enter formula..."/>
                </StackPanel>
            </Border>
        </StackPanel>

        <Border DockPanel.Dock="Bottom" Background="#F0F0F0" BorderBrush="#C0C0C0" BorderThickness="0,0,1,0" Padding="5,0">
            <Grid ColumnDefinitions="Auto, Auto, Auto, *">
                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="2" VerticalAlignment="Center" Margin="0,2">
                    <Button Classes="round" Command="{Binding AddRowToActiveCommand}" ToolTip.Tip="Add Row">
                        <TextBlock Text="+" FontWeight="Bold" Margin="0,-1,0,0"/>
                    </Button>
                    <Button Classes="round" Command="{Binding RemoveRowFromActiveCommand}" ToolTip.Tip="Remove Last Row">
                         <TextBlock Text="-" FontWeight="Bold" Margin="0,-2,0,0"/>
                    </Button>
                </StackPanel>

                <Border Grid.Column="1" Width="1" VerticalAlignment="Stretch" Background="#D0D0D0" Margin="8,4"/>

                <Button Grid.Column="2" 
                        Command="{Binding AddNewSheetCommand}"
                        ToolTip.Tip="New Sheet"
                        VerticalAlignment="Stretch"
                        VerticalContentAlignment="Center"
                        HorizontalContentAlignment="Center"
                        Padding="12,0"
                        Background="Transparent" 
                        BorderThickness="0" 
                        Foreground="#666666"
                        Margin="0,0,5,0">
                        <TextBlock Text="+" FontSize="18" FontWeight="Normal"/>
                </Button>

                <ScrollViewer Grid.Column="3" HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled">
                    <ListBox ItemsSource="{Binding Sheets}" SelectedItem="{Binding ActiveSheet}" Background="Transparent">
                        <ListBox.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Horizontal" Spacing="0"/>
                            </ItemsPanelTemplate>
                        </ListBox.ItemsPanel>
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <DockPanel LastChildFill="True">
                                    <Button DockPanel.Dock="Right" Classes="close" Content="✕"
                                            Command="{Binding DataContext.CloseSheetCommand, ElementName=RootWindow}"
                                            CommandParameter="{Binding}"/>
                                    <TextBlock Text="{Binding Name}" VerticalAlignment="Center"/>
                                </DockPanel>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </ScrollViewer>
            </Grid>
        </Border>

        <ContentControl Content="{Binding ActiveSheet}">
            <ContentControl.ContentTemplate>
                <DataTemplate DataType="sheetEditor:SheetViewModel">
                    <v:SheetView DataContext="{Binding}"/>
                </DataTemplate>
            </ContentControl.ContentTemplate>
        </ContentControl>

    </DockPanel>
</Window>